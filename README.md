# Cella

<h2>ATTENTION: This is a prerelease. Cella is not ready for production requirements.</h2>

_A no-nonsense & intuitive TypeScript template._

**Not another framework, but an open source template with best-in-class libraries. A singular stack to build performant, secure and modern web apps. By yourself or together.**

- Opinionated monorepo for fast fullstack development
- REST API designed for Server-Client & Server-Server (OpenAPI spec.)
- Secure and performant by design
- Configurable authentication and authorization flows
- Out-of-the-box integrations for essential tools
- Prebuilt endpoints for `organizations` & `users`

You can read the [Architecture](/info/ARCHITECTURE.md) file for specs and some conceptual decisions. Go to [Roadmap](/info/ROADMAP.md) to see where we are and what is in the works.

## Installation

### Step 1: Start project

#### Clone project & open directory

```bash
git clone https://github.com/shareworks/cella.git && cd cella
```

#### Env variables

In the `env` folder, you add a .env file using the `.env.example`. The minimum is the `DATABASE_URL` variable.

### Step 2

There are two ways to run Cella: A. Directly on local - or - B. From inside a container.

<details>
  <summary>A: Directly on local machine</summary>

#### Node 
Check your Node version with `node -v`. Install Node 20.x using [Volta](https://docs.volta.sh/guide/).

#### pnpm
Check your pnpm version with `pnpm -v`. Install pnpm 8.x using [Volta](https://docs.volta.sh/advanced/pnpm).

#### Postgres
Install PostgreSQL 16.x on your machine, for example using [Postgres.app](https://postgresapp.com/) if you are on a Mac.\
_TIP: Use [TablePlus](https://tableplus.com/) to manage your local Postgres db with an easy to use GUI._

</details>

<details>
  <summary>B: From inside a container</summary>

#### Prerequisites
- [Dev containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers)
- [Orbstack](https://orbstack.dev/) or [Docker](https://docs.docker.com/get-docker/)

#### Run devcontainer
- Open VSCode and click one of these buttons to run the container:
  <img width="1177" alt="Screenshot 2023-11-30 at 12 55 50" src="https://github.com/shareworks/cella/assets/238946/8ad1411b-749f-4383-ae53-3b9ed6593c66">
- Alternatively, open the project in VSCode and use `⌘+⇧+p` to run the `Remote-Containers: Reopen in Container` command.

#### Open database in TablePlus

- Open TablePlus and hit `Create a new connection...`.
- Click `Import from URL` and paste the following URL: `postgresql://user:password@db.cella-devcontainer.orb.local:5432/cella`

#### Problems?

- **Rebuilding the docker container**: Just open Orbstack and delete the container and volume that has `cella` in the name.

- **CORS issues**: Make sure to open `http://localhost:3000/` and not `http://127.0.0.1:3000/`
</details>

### Step 3

#### Download dependencies

```bash
pnpm install
```

#### Populate database

If starting from scratch, you will need to run a database migration to build the tables.

```bash
pnpm run migrate
```

The seed script will add an ADMIN user. Look into the [seed](/backend/seed/users.ts) for details.

```bash
pnpm run seed:users
```

#### Start

```bash
pnpm run dev
```
Check it out at <http://localhost:3000>!

## API documentation
Cella has autogenerated [API docs](https://api.cellajs.com/docs).

The documentation can be viewed on your local machine by going to `/docs` endpoint.

## More info

If you didn't cleanly close on your local, you might experience `EADDRINUSE` errors. Use the code below to get the process IDs and the second code to kill those processes.

```bash
sudo lsof -i :1080 -i :3000 -i :4000
```
Replace `*PID*` with a space separated list of `PID` that still run.

```bash
kill -9 *PID*
```
